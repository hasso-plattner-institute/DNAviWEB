<h2>Results</h2>

{% for f in files %}
  <div class="result-block" style="margin-bottom: 2em;">
    <p><strong>{{ f }}</strong></p>

    {# Images #}
    {% if f.lower().endswith(('.png', '.jpg', '.jpeg', '.svg')) %}
      <img src="{{ url_for('serve_result_file', output_id=output_id, filename=f) }}"
           style="max-width:600px; border:1px solid #ccc; padding:5px;" />

    {# PDFs (embedded or link) #}
    {% elif f.lower().endswith('.pdf') %}
      <iframe src="{{ url_for('serve_result_file', output_id=output_id, filename=f) }}"
              width="600" height="400" style="border:1px solid #ccc;">
      </iframe>
      <p><a href="{{ url_for('serve_result_file', output_id=output_id, filename=f) }}" target="_blank">
         Open PDF in new tab</a></p>

    {# CSVs as pre-rendered tables #}
    {% elif f.lower().endswith('.csv') %}
      {% for t in tables if t.name == f %}
        <div>{{ t.html | safe }}</div>
      {% endfor %}

    {# Everything else just as a download #}
    {% else %}
      <a href="{{ url_for('serve_result_file', output_id=output_id, filename=f) }}" target="_blank">
        Download {{ f }}
      </a>
    {% endif %}
  </div>
{% endfor %}
