<!doctype html>
<html lang="en">
  <!--begin::Head-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DNAvi | New Analysis</title>

    <!--begin::Accessibility Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="color-scheme" content="light dark" />
    <meta name="theme-color" content="#007bff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
    <!--end::Accessibility Meta Tags-->

    <!--begin::Primary Meta Tags-->
    <meta name="title" content="DNAvi | New Analysis" />
    <meta name="author" content="ColorlibHQ" />
    <meta
      name="description"
      content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS. Fully accessible with WCAG 2.1 AA compliance."
    />
    <meta
      name="keywords"
      content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard, accessible admin panel, WCAG compliant"
    />
    <!--end::Primary Meta Tags-->

    <!--begin::Accessibility Features-->
    <!-- Skip links will be dynamically added by accessibility.js -->
    <meta name="supported-color-schemes" content="light dark" />
    <link rel="preload" href="{{ url_for('static', filename='css/adminlte.css') }}" as="style" />
    <!--end::Accessibility Features-->

    <!--begin::Fonts-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
      integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
      crossorigin="anonymous"
      media="print"
      onload="this.media='all'"
    />
    <!--end::Fonts-->

    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css"
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(OverlayScrollbars)-->

    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(Bootstrap Icons)-->

    <!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/adminlte.css') }}" />
    <!--end::Required Plugin(AdminLTE)-->

    <!-- apexcharts -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.css"
      integrity="sha256-4MX+61mt9NVvvuPjUWdUdyfZfxSB1/Rf9WtqRHgG5S0="
      crossorigin="anonymous"
    />
  </head>

  <body class="layout-fixed sidebar-expand-lg sidebar-open bg-body-tertiary">
    <!-- Start Loading -->
    <div id="loading-overlay">
      <div class="spinner"></div>
      <p>Preparing your results… please wait.</p>
    </div>
    <style>
      #loading-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.9);
        z-index: 9999;
        text-align: center;
        padding-top: 20%;
        font-size: 1.5em;
        color: #007bff;
      }
      .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #007bff;
        border-radius: 50%;
        width: 60px; height: 60px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }
      @keyframes spin {100% {transform: rotate(360deg);}}
    </style>
    <!--end::Loading-->
    <!--begin::App Wrapper-->
    <div class="app-wrapper">
      <!--begin::Header-->
      <nav class="app-header navbar navbar-expand bg-body">
        <!--begin::Container-->
        <div class="container-fluid">
          <!--begin::Start Navbar Links-->
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
                <i class="bi bi-list"></i>
              </a>
            </li>
            <li class="nav-item d-none d-md-block">
              <a href="{{ url_for('home') }}" class="nav-link">Home</a>
            </li>
            <li class="nav-item d-none d-md-block">
              <a href="{{ url_for('contact') }}" class="nav-link">Contact</a>
            </li>
          </ul>
          <!--end::Start Navbar Links-->

          <!--begin::End Navbar Links-->
          <ul class="navbar-nav ms-auto">
            <!--begin::Navbar Search-->
            <li class="nav-item">
              <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                <i class="bi bi-search"></i>
              </a>
            </li>
            <!--end::Navbar Search-->

            <!--begin::Fullscreen Toggle-->
            <li class="nav-item">
              <a class="nav-link" href="#" data-lte-toggle="fullscreen">
                <i data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i>
                <i data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none"></i>
              </a>
            </li>
            <!--end::Fullscreen Toggle-->
          </ul>
          <!--end::End Navbar Links-->
        </div>
        <!--end::Container-->
      </nav>
      <!--end::Header-->
      <!--begin::Sidebar-->
      <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark">
        <!--begin::Sidebar Brand-->
        <div class="sidebar-brand">
          <!--begin::Brand Link-->
          <a class="d-flex align-items-center">
            <!--begin::Brand Image-->
            <img
              src="{{ url_for('static', filename='img/logo.svg') }}"
              alt="DNAvi Logo"
              class="brand-image opacity-75 shadow me-2"
              style="height: 60px; width: auto;"
            />
            <!--end::Brand Image-->
            <!--begin::Brand Text-->
            <span class="brand-text fw-light">DNAvi</span>
            <!--end::Brand Text-->
          </a>
          <!--end::Brand Link-->
        </div>
        <!--end::Sidebar Brand-->
        <!--begin::Sidebar Wrapper-->
        <div class="sidebar-wrapper">
          <nav class="mt-2">
            <!--begin::Sidebar Menu-->
            <ul
              class="nav sidebar-menu flex-column"
              data-lte-toggle="treeview"
              role="navigation"
              aria-label="Main navigation"
              data-accordion="false"
              id="navigation"
            >
              <li class="nav-item">
                 <a href="{{ url_for('submissions_dashboard') }}" class="nav-link">
                  <i class="nav-icon bi bi-speedometer"></i>
                  <p>
                    Submissions Dashboard
                  </p>
                </a>
              </li>

              <li class="nav-item">
                 <a href="{{ url_for('protect') }}" class="nav-link">
                  <i class="bi bi-graph-up"></i>
                  <p>
                    New Analysis
                  </p>
                </a>
              </li>
              <li class="nav-item"><a href="{{ url_for('documentation') }}" class="nav-link"><i class="bi bi-file-earmark-text"></i><p>Documentation</p></a></li>
            <!--end::Sidebar Menu-->
          </nav>
        </div>
        <!--end::Sidebar Wrapper-->
      </aside>
      <!--end::Sidebar-->
      <!--begin::App Main-->
      <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <div class="row align-items-center">
                <div class="col-sm-6">
                  <h3 class="mb-0">DNAvi - Cell-free DNA visualization and analysis</h3>
                </div>
                <div class="col-sm-6">
                  <ol class="breadcrumb float-sm-end">
                    <li class="breadcrumb-item"><a href="{{ url_for('home')}}">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">New Analysis</li>
                  </ol>
                </div>
              </div>
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <div class="app-content">
          <main id="content-box" class="order-first">
            <!-- --------------------------------------------------------------------------------------------------- -->
            <!-- HEADER WITH LOGO -->
            <!-- --------------------------------------------------------------------------------------------------- -->
            <section class="work-section section" id="section-2">
                <div class="container">
                    <style> img {float: right;} </style>
                    <div class="center">
                    <br></br>
                    </div>
            <!-- --------------------------------------------------------------------------------------------------- -->
            <!-- 1: INPUT SECTION -->
            <!-- --------------------------------------------------------------------------------------------------- -->
                    <div class="row">
                        <div class="item col-md-4">
                            <div class="effect-julia item">
                                <!-- ------------------------------------------------------------------------------ -->
                                <!-- DNA GEL OR CSV -->
                                <!-- ------------------------------------------------------------------------------ -->
                                <img src="./static/img/all_input_descr.svg" alt="Minerva" width=100%; height=auto>
                                <h3>1. Upload DNA Table or Gel</h3>
                                <form method="POST" enctype="multipart/form-data">
                                <input type="file" name="data_file" accept=".txt,.tsv,.csv,.png,.jpg,.jpeg">
                                <p>Max. 16 MB file size allowed. <a href="./static/tables/examples.zip">
                                    Download examples</a>.</p>
                                 <br></br>
                                <!-- ------------------------------------------------------------------------------ -->
                                <!-- LADDER ANNOTATION CSV-->
                                <!-- ------------------------------------------------------------------------------ -->
                                <details> <summary>Required: annotate DNA ladder</summary>
                                    <a href="./static/tables/ladder.csv"> Download example</a>.</p>
                                    <img src="./static/img/annotate.svg" alt="Minerva" width=60%; height=auto>
                                    <form method="POST" enctype="multipart/form-data">
                                    <input type="file" name="ladder_file" accept=".txt,.tsv,.csv">
                                    <p>Next, annotate basepairs (bp). Note: peaks annotated as "marker" will be excluded from analysis.

                                </details>
                                <!-- ------------------------------------------------------------------------------ -->
                                <!-- METADATA CSV-->
                                <!-- ------------------------------------------------------------------------------ -->
                                <details> <summary>Optional: Add metadata</summary>
                                    <img src="./static/img/metadata.svg" alt="Minerva" width=60%; height=auto>
                                     <form method="POST" enctype="multipart/form-data">
                                    <input type="file" name="meta_file" accept=".txt,.tsv,.csv">
                                    <p>Add any group information <a href="./static/tables/metadata.csv"
                                    > Download example</a>.</p>

                                    <!-- New dynamic sample metadata -->
                                    <h5>Or enter metadata per sample:</h5>
                                    <div id="samples-container">
                                        <div class="sample-meta mb-3 p-3 border rounded">
                                            <!-- Sample ID -->
                                            <label>Sample ID</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                              <input type="text" name="sample_id[]" class="form-control mb-2" placeholder="e.g. Sample_1">
                                            </div>
                                            <!-- Subject ID -->
                                            <label>Subject ID</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                              <input type="text" name="subject_id[]" class="form-control mb-2" placeholder="e.g. Donor-10031" 
                                                      title="A unique identifier for the subject the sample derives from. Shall not contain personal sensitive data.">
                                            </div>
                                            <!-- Disease -->
                                            <label>Disease (EFO/ORDO/MONDO term)</label>
                                            <div class="disease-wrapper suggestion-wrapper" style="position: relative;">
                                                <div class="disease-field mb-2">
                                                    <input type="text" name="disease[0][]" class="form-control mb-2 ols-search" placeholder="Search disease ontology">
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-primary add-disease-btn">+ Add another disease</button>
                                            </div>
                                            <!-- Cell Type -->
                                            <label>Cell Type (CL ontology)</label>
                                            <div class="celltype-wrapper suggestion-wrapper" style="position: relative;">
                                                <div class="celltype-field mb-2">
                                                    <input type="text" name="cell_type[0][]" class="form-control mb-2 ols-search" 
                                                          placeholder="Search cell type ontology (e.g. CL:0000127 neuron)">
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-primary add-celltype-btn">+ Add another cell type</button>
                                            </div>
                                            <!-- Phenotypic Abnormality -->
                                            <label>Phenotypic Abnormality (HP term)</label>
                                            <div class="phenotype-wrapper suggestion-wrapper" style="position: relative;">
                                                <div class="phenotype-field mb-2">
                                                    <input type="text" name="phenotypic_abnormality[0][]" class="form-control mb-2 ols-search" placeholder="Search HP ontology">
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-primary add-phenotype-btn">+ Add another phenotypic abnormality</button>
                                            </div>
                                            <!-- Material Anatomical Entity -->
                                            <label>Material Anatomical Entity (UBERON)</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                              <input type="text" name="material[]" class="form-control mb-2 ols-search" placeholder="Search anatomical entity">
                                            </div>
                                            <!-- Biological Sex -->
                                            <label>Biological Sex</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="biological_sex[]" class="form-control mb-2" required>
                                                    <option value="" disabled selected>Select biological sex</option>
                                                    <option value="male">Male</option>
                                                    <option value="female">Female</option>
                                                    <option value="hermaphrodite">Hermaphrodite</option>
                                                    <option value="pseudohermaphrodite">Pseudohermaphrodite</option>
                                                    <option value="unknown">Unknown</option>
                                                </select>
                                            </div>
                                            <!-- Age -->
                                            <label>Age</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <input type="number" name="age[]" class="form-control mb-2" placeholder="Age in years" min="0" step="0.01"
                                                      title="Age of the subject in years. Use decimals if needed.">
                                            </div>
                                            <!-- Organism -->
                                            <label>Organism</label>
                                            <div class="organism-wrapper suggestion-wrapper" style="position: relative;">
                                              <div class="phenotype-field mb-2">
                                                <input type="text" name="organism[]" class="form-control mb-2 ols-search" placeholder="Search organism e.g. human, dog">
                                              </div>
                                            </div>
                                            <!-- Sample Collection Date -->
                                            <label>Sample Collection Date</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <input type="date" name="collection_date[]" class="form-control mb-2" 
                                                      title="Date the sample was collected">
                                            </div>
                                            <!-- Case vs Control -->
                                            <label>Case vs Control</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="case_vs_control[]" class="form-control mb-2" required>
                                                    <option value="" disabled selected>Select status</option>
                                                    <option value="case">Case</option>
                                                    <option value="control">Control</option>
                                                    <option value="not applicable">Not applicable</option>
                                                </select>
                                            </div>
                                            <!-- Condition Under Study -->
                                            <label>Condition Under Study</label>
                                            <div class="condition-wrapper suggestion-wrapper" style="position: relative;">
                                                <div class="condition-field mb-2">
                                                    <input type="text" name="condition_under_study[0][]" 
                                                          class="form-control mb-2 ols-search" 
                                                          placeholder="Search condition under study (e.g. NCIT:C161319)">
                                                </div>
                                            </div>
                                            <!-- Is Deceased -->
                                            <label>Is Deceased?</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="is_deceased[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select</option>
                                                    <option value="true">Yes</option>
                                                    <option value="false">No</option>
                                                </select>
                                            </div>

                                            <!-- Infection suspected -->
                                            <label>Is Infection Suspected?</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="is_infection_suspected[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select</option>
                                                    <option value="true">Yes</option>
                                                    <option value="false">No</option>
                                                </select>
                                            </div>

                                            <!-- Infection Strain -->
                                            <label>If infection suspected, specify strain:</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <input type="text" name="infection_strain[]" class="form-control mb-2" placeholder="e.g., Staphylococcus aureus">
                                            </div>

                                            <!-- Is Pregnant -->
                                            <label>Is Pregnant?</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="is_pregnant[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select</option>
                                                    <option value="true">Yes</option>
                                                    <option value="false">No</option>
                                                </select>
                                            </div>

                                            <!-- Hospitalization Status -->
                                            <label>Hospitalization Status</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="hospitalization_status[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select status</option>
                                                    <option value="ambulant">Ambulant</option>
                                                    <option value="hospitalized">Hospitalized</option>
                                                    <option value="emergency room">Emergency Room</option>
                                                    <option value="discharged">Discharged</option>
                                                    <option value="standard care unit">Standard Care Unit</option>
                                                    <option value="intensive care unit">Intensive Care Unit</option>
                                                    <option value="operation room">Operation Room</option>
                                                </select>
                                            </div>

                                            <!-- Extraction Kit -->
                                            <label>Extraction Kit</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <input type="text" name="extraction_kit[]" class="form-control mb-2" placeholder="e.g., Invitrogen kit">
                                            </div>

                                            <!-- DNA Mass -->
                                            <label>DNA Mass</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <input type="number" name="dna_mass[]" class="form-control mb-2" placeholder="Numeric value" step="0.01" min="0">
                                            </div>

                                            <!-- DNA Mass Units -->
                                            <label>DNA Mass Units</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="dna_mass_units[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select unit</option>
                                                    <option value="pg">pg</option>
                                                    <option value="ng">ng</option>
                                                    <option value="µg">µg</option>
                                                </select>
                                            </div>

                                            <!-- Carrying Liquid Volume -->
                                            <label>Carrying Liquid Volume</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <input type="number" name="carrying_liquid_volume[]" class="form-control mb-2" placeholder="Numeric value" step="0.01" min="0">
                                            </div>

                                            <!-- Carrying Liquid Volume Unit -->
                                            <label>Carrying Liquid Volume Unit</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="carrying_liquid_volume_unit[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select unit</option>
                                                    <option value="µL">µL</option>
                                                    <option value="mL">mL</option>
                                                    <option value="L">L</option>
                                                </select>
                                            </div>

                                            <!-- In vitro / In vivo -->
                                            <label>In vitro / In vivo</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="in_vitro_in_vivo[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select</option>
                                                    <option value="in_vitro">In vitro</option>
                                                    <option value="in_vivo">In vivo</option>
                                                </select>
                                            </div>

                                            <!-- Gel Electrophoresis Device -->
                                            <label>Gel Electrophoresis Device</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <input type="text" name="device[]" class="form-control mb-2" placeholder="Enter device">
                                            </div>
                                            <!-- Ladder Type -->
                                            <label>Gel Electrophoresis Ladder Type</label>
                                            <div class="suggestion-wrapper" style="position: relative;">
                                                <select name="ladder_type[]" class="form-control mb-2">
                                                    <option value="" disabled selected>Select ladder type</option>
                                                    <option value="ladder type 1">Lader type 1</option>
                                                    <option value="ladder type 1">Lader type 2</option>
                                                    <option value="ladder type 1">Lader type 3</option>
                                                    <option value="Custom">Custom</option>
                                                </select>
                                                <input type="text" name="ladder_type_custom[]" class="form-control mb-2 ladder-type-custom" placeholder="Enter custom ladder type" style="display:none;">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" id="add-sample" class="btn btn-outline-primary btn-sm mt-2">
                                      + Add Another Sample
                                    </button>
                                    <button id="download-csv" class="btn btn-success mb-3">Download CSV</button>
                                    <table id="samples-table" class="table table-bordered">
  <thead>
    <tr>
      <th>Sample ID</th>
      <th>Subject ID</th>
      <th>Disease</th>
      <th>Cell Type</th>
      <th>Phenotypic Abnormality</th>
      <th>Material</th>
      <th>Biological Sex</th>
      <th>Age</th>
      <th>Organism</th>
      <th>Collection Date</th>
      <th>Case vs Control</th>
      <!-- add more metadata columns as needed -->
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td>
        <button type="button" class="btn btn-sm btn-outline-primary add-row">+</button>
        <button type="button" class="btn btn-sm btn-outline-danger remove-row">-</button>
      </td>
    </tr>
  </tbody>
</table>
<button id="download-csv" class="btn btn-success">Download CSV</button>

                                  <!-- Choose Metadata to use for grouping analyses -->
                                  <div class="mt-5 p-4 border rounded bg-white w-100">
                                    <h4 class="mb-3">Group Analysis by Metadata</h4>
                                    <p class="text-muted">
                                      Select one or more metadata fields to group your results by.
                                      <br>
                                      <strong>Each selected metadata will trigger a separate analysis rerun.</strong>
                                      <br>
                                      For example, selecting <em>Disease</em> and <em>Biological Sex</em> will produce two full analyses —
                                      one grouped by Disease and another grouped by Biological Sex.
                                      <br>
                                      <em>If you do not select any, a single combined analysis using all metadata will be performed (this may take longer).</em>
                                    </p>

                                    <div class="mt-3 mb-3">
                                      <h6>Select metadata columns to group by:</h6>
                                      <div class="row row-cols-1 row-cols-md-3 g-2 mt-2">
                                        <!-- Column 1 -->
                                        <div class="col">
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="subject_id" id="group_subject_id">
                                            <label class="form-check-label" for="group_subject_id">Subject ID</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="disease" id="group_disease">
                                            <label class="form-check-label" for="group_disease">Disease</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="cell_type" id="group_cell_type">
                                            <label class="form-check-label" for="group_cell_type">Cell Type</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="phenotypic_abnormality" id="group_phenotype">
                                            <label class="form-check-label" for="group_phenotype">Phenotypic Abnormality</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="material" id="group_material">
                                            <label class="form-check-label" for="group_material">Material Anatomical Entity</label>
                                          </div>
                                        </div>

                                        <!-- Column 2 -->
                                        <div class="col">
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="biological_sex" id="group_sex">
                                            <label class="form-check-label" for="group_sex">Biological Sex</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="age" id="group_age">
                                            <label class="form-check-label" for="group_age">Age</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="organism" id="group_organism">
                                            <label class="form-check-label" for="group_organism">Organism</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="case_vs_control" id="group_casecontrol">
                                            <label class="form-check-label" for="group_casecontrol">Case vs Control</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="condition_under_study" id="group_condition">
                                            <label class="form-check-label" for="group_condition">Condition Under Study</label>
                                          </div>
                                        </div>

                                        <!-- Column 3 -->
                                        <div class="col">
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="is_deceased" id="group_deceased">
                                            <label class="form-check-label" for="group_deceased">Is Deceased</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="is_infection_suspected" id="group_infection">
                                            <label class="form-check-label" for="group_infection">Infection Suspected</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="is_pregnant" id="group_pregnant">
                                            <label class="form-check-label" for="group_pregnant">Is Pregnant</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="hospitalization_status" id="group_hosp">
                                            <label class="form-check-label" for="group_hosp">Hospitalization Status</label>
                                          </div>
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="ladder_type" id="group_ladder">
                                            <label class="form-check-label" for="group_ladder">Ladder Type</label>
                                          </div>
                                        </div>
                                      </div>
                                    </div>

                                    <button id="apply-grouping" type="button" class="btn btn-outline-primary mt-3">
                                      Apply Selected Grouping
                                    </button>
                                  </div>
                                  </details>
                                  <script>
                                    // Add another sample's metadata (copy the last filled sample metadata)
                                    document.getElementById("add-sample").addEventListener("click", function () {
                                      const container = document.getElementById("samples-container");
                                      const lastSample = container.lastElementChild;
                                      const clone = lastSample.cloneNode(true);
                                      container.appendChild(clone);
                                    });
                                    // Download csv of the metadata so far
                                    document.getElementById("download-csv").addEventListener("click", function() {
                                    const container = document.getElementById("samples-container");
                                    const rows = container.querySelectorAll(".sample-meta");
                                    if(rows.length === 0) return alert("No samples added!");
                                    const header = Array.from(rows[0].querySelectorAll("input, select")).map(el => el.name.replace(/\[\]/, ''));
                                    const csvRows = [header.join(",")];
                                    rows.forEach(row => {
                                      const values = Array.from(row.querySelectorAll("input, select")).map(el => {
                                        let val = el.value;
                                        if(val.includes(',')) val = `"${val}"`;
                                        return val;
                                      });
                                      csvRows.push(values.join(","));
                                    });
                                    const csvContent = csvRows.join("\n");
                                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = 'samples_metadata.csv';
                                    document.body.appendChild(a);
                                    a.click();
                                    document.body.removeChild(a);
                                  });
                                  </script>
                                </details>
                                <br></br>
                                <footer><p>Need help? Use our <a href="{{ url_for('documentation') }}"> documentation</a>.</p></footer>
                            </div>
                        </div>

                       <!-- ---------------------------------------------------------------------------------------- -->
                       <!-- SUBMISSION -->
                       <!-- ---------------------------------------------------------------------------------------- -->
                        <div class="item col-md-4 one">
                            <div class="tm-work-item-inner">
                                <img src="./static/img/submit.svg" alt="Minerva" width=100%; height=auto>
                                <h3>2. Submit for Analysis</h3>
                                <p>Your DNA file will be analysed for peaks, height normalized,
                                    and grouped in case you provided metadata. Be patient, this may take a while.</p>
                                <button type="submit" class="btn btn-success" >Submit</button>
                                </form>

                                <!-- ------------------------------------------------------------------------------ -->
                                <!-- DISPLAY ERROR MESSAGES HERE
                                <!-- ------------------------------------------------------------------------------ -->
                                <style> .error {background-color: #ea7f81 !important; display: inline-block}</style>
                                {% with messages = get_flashed_messages() %}
                                {% if messages %}
                                    <ul class=flashes>
                                    {% for message in messages %}
                                    <li>{{ message }}</li>
                                    {% endfor %}
                                    </ul>
                                    {% endif %}
                                {% endwith %}
                                {% block body %}{% endblock %}

                                <!-- ------------------------------------------------------------------------------ -->
                                <!-- FILE MISSING
                                <!-- ------------------------------------------------------------------------------ -->
                                    <br></br>
                                    {% if missing_error %}
                                    <br></br>
                                     <p class=error><strong>Error:</strong> {{ missing_error }} </p>
                                    {% endif %}

                                <!-- ------------------------------------------------------------------------------ -->
                                <!-- OTHER ERROR
                                <!-- ------------------------------------------------------------------------------ -->
                                    {% if error %}
                                    <br></br>
                                    <p class=error><strong>Error:</strong> {{ error }} </p>
                                    <br></br>
                                    {% endif %}
                            </div>
                        </div>
                       <!-- ---------------------------------------------------------------------------------------- -->
                       <!-- DOWNLOAD INFORMATION-->
                       <!-- ---------------------------------------------------------------------------------------- -->
                        <div class="item col-md-4 two">
                            <div class="tm-work-item-inner">
                                <img src="./static/img/download.svg" alt="Minerva" width=100%; height=auto>
                                <h3>3. Explore Analysis Results & Download</h3>
                                <p>View your analysis results interactively in the web interface, or download a ZIP folder containing all results and plots. 
                                   You are allowed to use this for your work only if you cite DNAvi.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!--end::App Content-->
      </main>
      <!--end::App Main-->
      <!--begin::Footer-->
      <footer class="app-footer d-flex justify-content-between align-items-center px-3 py-2 border-top">
        <div>
            Copyright &copy; Anja Hess, Yara Matani, 2025.
        </div>
        <div>
            Design by &copy; 
            <a href="https://adminlte.io" class="text-decoration-none" target="_blank">AdminLTE.io</a>, 2014-2025.
        </div>
      </footer>
      <!--end::Footer-->
    </div>
    <!--end::App Wrapper-->
    <!--begin::Script-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script
      src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script src="{{ url_for('static', filename='./js/adminlte.js') }}"></script>
    <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
    <script>
      const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
      const Default = {
        scrollbarTheme: 'os-theme-light',
        scrollbarAutoHide: 'leave',
        scrollbarClickScroll: true,
      };
      document.addEventListener('DOMContentLoaded', function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);

        // Disable OverlayScrollbars on mobile devices to prevent touch interference
        const isMobile = window.innerWidth <= 992;

        if (
          sidebarWrapper &&
          OverlayScrollbarsGlobal?.OverlayScrollbars !== undefined &&
          !isMobile
        ) {
          OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
            scrollbars: {
              theme: Default.scrollbarTheme,
              autoHide: Default.scrollbarAutoHide,
              clickScroll: Default.scrollbarClickScroll,
            },
          });
        }
      });
    </script>
    <!--end::OverlayScrollbars Configure-->

    <!-- OPTIONAL SCRIPTS -->

    <!-- apexcharts -->
    <script
      src="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.min.js"
      integrity="sha256-+vh8GkaU7C9/wbSLIcwq82tQ2wTf44aOHA8HlBMwRI8="
      crossorigin="anonymous"
    ></script>
    <!--end::Script-->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        form.addEventListener("submit", function () {
          document.getElementById("loading-overlay").style.display = "block";
        });
      });
    </script>
    <!--begin::Metdata from OLS Autocomplete script-->
    <script src="{{ url_for('static', filename='./js/autocomplete.js') }}"></script>
    <!--end::Metdata from OLS Autocomplete script-->
  </body>
  <!--end::Body-->
</html>
